/*! silverstripe-cloudinary - v2.0.0 */!function(){"use strict";class i{constructor(t){this.values=[],this.delimiter=":",this.hasValue(t)&&this.addValue(t)}toString(){return this.values.join(this.delimiter)}hasValue(t){return null!=t&&""!==t}addValue(t){return Array.isArray(t)?this.values=this.values.concat(t):this.values.push(t),this.values=this.values.filter(t=>this.hasValue(t)),this}setDelimiter(t){return this.delimiter=t,this}}class e extends Error{constructor(t="Unsupported"){super(t)}}function r(t){return new e(t)}class t{constructor(){this._qualifierModel={}}toJson(){return function(){return this._qualifierModel||{error:r(`unsupported qualifier ${this.constructor.name}`)}}.apply(this)}}class n extends t{constructor(t,e){super(),this.delimiter="_",this.key=t,e instanceof i?this.qualifierValue=e:(this.qualifierValue=new i,this.qualifierValue.addValue(e))}toString(){const{key:t,delimiter:e,qualifierValue:r}=this;return`${t}${e}${r.toString()}`}addValue(t){return this.qualifierValue.addValue(t),this}}class s extends n{constructor(t,e){let r;r=e?new i([t,`${e}`]).setDelimiter(":"):t,super("fl",r),this.flagValue=e}toString(){return super.toString().replace(/\./g,"%2E")}getFlagValue(){return this.flagValue}}class o{constructor(){this._actionModel={}}toJson(){return function(){var t=this._actionModel&&Object.keys(this._actionModel).length,e=null===(e=null===(e=null===(e=this._actionModel)||void 0===e?void 0:e.source)||void 0===e?void 0:e.transformation)||void 0===e?void 0:e.error;return e&&e instanceof Error?{error:e}:t?this._actionModel:{error:r(`unsupported action ${this.constructor.name}`)}}.apply(this)}}class a extends o{constructor(){super(...arguments),this.qualifiers=new Map,this.flags=[],this.delimiter=",",this.actionTag=""}prepareQualifiers(){}getActionTag(){return this.actionTag}setActionTag(t){return this.actionTag=t,this}toString(){return this.prepareQualifiers(),function(t,e){const r=Array.from(t.entries());return e.forEach(t=>{r.push(["fl",t])}),r.sort().map(t=>t[1])}(this.qualifiers,this.flags).join(this.delimiter)}addQualifier(t){var e,r;return"string"==typeof t?([e,r]=t.toLowerCase().split("_"),"fl"===e?this.flags.push(new s(r)):this.qualifiers.set(e,new n(e,r))):this.qualifiers.set(t.key,t),this}addFlag(t){return"string"==typeof t?this.flags.push(new s(t)):t instanceof s&&this.flags.push(t),this}addValueToQualifier(t,e){return this.qualifiers.get(t).addValue(e),this}}class u extends a{constructor(t){var e;super(),this._actionModel={},this.addQualifier(new n("b",new i((e=t)&&(e.match(/^#/)?`rgb:${e.substr(1)}`:e)).setDelimiter("_"))),this._actionModel.color=t,this._actionModel.actionType="backgroundColor"}static fromJson(t){var t=t["color"];return new this(t)}}class c{constructor(t){this.raw=t}toString(){return this.raw}toJson(){return{error:r(`unsupported action ${this.constructor.name}`)}}}function l(){return new s("lossy")}function h(){return new s("preserve_transparency")}function p(t){return new s("progressive",t)}class f extends i{constructor(t){super(t),this.val=t}getValue(){return this.val}}function d(e){const r={};return Object.keys(e).forEach(t=>{r[e[t]]=t}),r}d({444:"CHROMA_444",420:"CHROMA_420"}),d({noCmyk:"no_cmyk",keepCmyk:"keep_cmyk",tinySrgb:"tinysrgb",srgbTrueColor:"srgb:truecolor"}),d({limitFit:"limit",limitFill:"lfill",minimumFit:"mfit",thumbnail:"thumb",limitPad:"lpad",minimumPad:"mpad",autoPad:"auto_pad"});const g=d({colorSpace:"cs",dpr:"dpr",density:"dn",defaultImage:"d",format:"f",quality:"q"});d({redEye:"redeye",advancedRedEye:"adv_redeye",oilPaint:"oil_paint",unsharpMask:"unsharp_mask",makeTransparent:"make_transparent",generativeRestore:"gen_restore",upscale:"upscale"}),d({autoBest:"auto:best",autoEco:"auto:eco",autoGood:"auto:good",autoLow:"auto:low",jpegminiHigh:"jpegmini:1",jpegminiMedium:"jpegmini:2",jpegminiBest:"jpegmini:0"}),d({fullHd:"full_hd",fullHdWifi:"full_hd_wifi",fullHdLean:"full_hd_lean",hdLean:"hd_lean"});class m extends a{constructor(t,e,r){super(),this._actionModel={};let i;i=e instanceof f?e.getValue():e,this._actionModel.actionType=g[t],this._actionModel[r]=i,this.addQualifier(new n(t,e))}}class y extends s{constructor(t){super("progressive",t)}}y;class v extends m{constructor(t,e){super(t,e,"formatType")}lossy(){return this._actionModel.lossy=!0,this.addFlag(l()),this}progressive(t){return t instanceof y?(this._actionModel.progressive={mode:t.getFlagValue()},this.addFlag(t)):(this._actionModel.progressive={mode:t},this.addFlag(p(t))),this}preserveTransparency(){return this._actionModel.preserveTransparency=!0,this.addFlag(h()),this}static fromJson(t){var{formatType:e,lossy:r,progressive:i,preserveTransparency:t}=t;let n;return n=e?new this("f",e):new this("f"),i&&(i.mode?n.progressive(i.mode):n.progressive()),r&&n.lossy(),t&&n.preserveTransparency(),n}}class _{constructor(){this.actions=[]}addAction(t){let e;if("string"==typeof t){if(0<=t.indexOf("/"))throw"addAction cannot accept a string with a forward slash in it - /, use .addTransformation() instead";e=new c(t)}else e=t;return this.actions.push(e),this}addTransformation(t){return t instanceof _?this.actions=this.actions.concat(t.actions):this.actions.push(new c(t)),this}toString(){return this.actions.map(t=>t.toString()).filter(t=>t).join("/")}animated(t){return this.addAction(t)}border(t){return this.addAction(t)}reshape(t){return this.addAction(t)}resize(t){return this.addAction(t)}quality(t){return this.addAction(new v("q",t)),this}format(t){return this.addAction(new v("f",t)),this}roundCorners(t){return this.addAction(t)}overlay(t){return this.addAction(t)}underlay(t){return t.setLayerType("u"),this.addAction(t)}addVariable(t){return this.addAction(t)}conditional(t){return this.addAction(t)}effect(t){return this.addAction(t)}adjust(t){return this.addAction(t)}rotate(t){return this.addAction(t)}namedTransformation(t){return this.addAction(t)}delivery(t){return this.addAction(t)}backgroundColor(t){return this.addAction(new u(t))}psdTools(t){return this.addAction(t)}extract(t){return this.addAction(t)}addFlag(t){const e=new a;let r=t;return"string"==typeof t&&(r=new s(t)),e.addQualifier(r),this.addAction(e)}customFunction(t){return this.addAction(t)}transcode(t){return this.addAction(t)}videoEdit(t){return this.addAction(t)}toJson(){const t=[];for(const i of this.actions){var e=i.toJson();if("error"in(r=e)&&r.error)return e;t.push(e)}var r;return{actions:t}}}class b extends _{}var w=class{filterOutNonSupportedKeys(e,r){const i=Object.create({});return"object"!=typeof(t=e)||t instanceof Array?Object.create({}):(Object.keys(e).forEach(t=>{0<=r.indexOf(t)?i[t]=e[t]:console.warn("Warning - unsupported key provided to configuration: ",t)}),i);var t}};const x=["cname","secureDistribution","privateCdn","signUrl","longUrlSignature","shorten","useRootPath","secure","forceVersion","analytics","queryParams"];(class extends w{});var j=class Ar extends w{constructor(t){super(),t=this.filterOutNonSupportedKeys(t,x),Object.assign(this,{secure:!0},t)}extend(t){return t=this.filterOutNonSupportedKeys(t,x),new Ar(Object.assign({},this,t))}setCname(t){return this.cname=t,this}setSecureDistribution(t){return this.secureDistribution=t,this}setPrivateCdn(t){return this.privateCdn=t,this}setSignUrl(t){return this.signUrl=t,this}setLongUrlSignature(t){return this.longUrlSignature=t,this}setShorten(t){return this.shorten=t,this}setUseRootPath(t){return this.useRootPath=t,this}setSecure(t){return this.secure=t,this}setForceVersion(t){return this.forceVersion=t,this}setQueryParams(t){return this.queryParams=t,this}};function A(t,e,r){e>>=0;let i=String(void 0!==r?r:" ");return t.length>e?String(t):((e-=t.length)>i.length&&(i+=function(t,e){let r=e,i="";for(;0<r;)i+=t,r--;return i}(i,e/i.length)),i.slice(0,e)+String(t))}const S={};let O=0;function $(t){let e="";var r=6*t.split(".").length;const i=function(t){if(t.split(".").length<2)throw new Error("invalid semVer, must have at least two segments");return t.split(".").map(t=>{var e=+t;if(isNaN(e)||e<0)throw"Invalid version number provided";return A(t,2,"0")}).join(".")}(function(t){if(t.split(".").length<2)throw new Error("invalid semVer, must have at least two segments");return t.split(".").reverse().join(".")}(t)),n=parseInt(i.split(".").join(""));let s=n.toString(2);if(s=A(s,r,"0"),s.length%6!=0)throw"Version must be smaller than 43.21.26)";return s.match(/.{1,6}/g).forEach(t=>{e+=S[t]}),e}"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(t=>{var e=A(e=O.toString(2),6,"0");S[e]=t,O++});const C="1.21.0";function P(t){var e={techVersion:function(){var e="0.0.0";if("undefined"!=typeof window)return e;try{return process.versions.node||e}catch(t){return e}}(),sdkCode:"T",sdkSemver:C.split("-")[0],product:"A",osType:"Z",osVersion:"0.0",responsive:!1,placeholder:!1,lazyload:!1,accessibility:!1};return t?Object.assign(Object.assign({},e),t):e}function k(t){t=function(t){const e={sdkSemver:t.sdkSemver,techVersion:t.techVersion,sdkCode:t.sdkCode,product:t.product,feature:"0",osType:t.osType,osVersion:t.osVersion};return t.accessibility&&(e.feature="D"),t.lazyload&&(e.feature="C"),t.responsive&&(e.feature="A"),t.placeholder&&(e.feature="B"),e}(P(t));try{var e=function(t){t=t.split(".");return`${t[0]}.${t[1]}`}(t.techVersion),r=$(t.sdkSemver),i=$(e),n=function(t){var[e,t]=t.split(".");const r=parseInt(e).toString(2),i=parseInt(t).toString(2);return e=r.padStart(6,"0"),t=i.padStart(6,"0"),S[e]+S[t]}(t.osVersion),s=t.feature,o=t.sdkCode,{product:a,osType:u}=t;return`D${a}${o}${r}${i}${u}${n}${s}`}catch(t){return"E"}}const T={"image/upload":"images","image/private":"private_images","image/authenticated":"authenticated_images","raw/upload":"files","video/upload":"videos"};class V extends class{constructor(t,e={},r){this.setPublicID(t),this.setCloudConfig(e),this.setURLConfig(r)}setURLConfig(t){return this.urlConfig=new j(t),this}setCloudConfig(t){return this.cloudName=t.cloudName,this.apiKey=t.apiKey,this.apiSecret=t.apiSecret,this.authToken=t.authToken,this}setPublicID(t){return this.publicID=t?t.toString():"",this}setDeliveryType(t){return this.deliveryType=t,this}setSuffix(t){return this.suffix=t,this}setSignature(t){return this.signature=t,this}setVersion(t){return t&&(this.version=t),this}setAssetType(t){return t&&(this.assetType=t),this}sign(){return this}toURL(t={}){return this.createCloudinaryURL(null,t.trackedAnalytics)}validateAssetForURLCreation(){if(void 0===this.cloudName)throw"You must supply a cloudName when initializing the asset";var t=this.suffix&&0<=this.suffix.indexOf("."),e=this.suffix&&0<=this.suffix.indexOf("/");if(t||e)throw"`suffix`` should not include . or /"}getResourceType(){var t=this.assetType||"image",e=this.deliveryType||"upload",r=!!this.suffix,i=`${t}/${e}`,n=T[`${t}/${e}`],t=this.urlConfig.useRootPath,e=this.urlConfig.shorten;if(t){if("image/upload"==i)return"";throw new Error(`useRootPath can only be used with assetType: 'image' and deliveryType: 'upload'. Provided: ${i} instead`)}if(e&&"image/upload"==i)return"iu";if(r){if(n)return n;throw new Error(`URL Suffix only supported for ${Object.keys(T).join(", ")}, Provided: ${i} instead`)}return i}getSignature(){return this.signature?`s--${this.signature}--`:""}createCloudinaryURL(e,r){if(!this.publicID)return"";this.validateAssetForURLCreation();const i=(l=this.cloudName,t=this.urlConfig,s=t.secure,n=t.privateCdn,o=t.cname,t=t.secureDistribution,s||o?s&&!t&&n?`https://${l}-res.cloudinary.com`:s&&!t?`https://res.cloudinary.com/${l}`:s&&t&&n?`https://${t}`:s&&t?`https://${t}/${l}`:!s&&o?`http://${o}/${l}`:"ERROR":`http://res.cloudinary.com/${l}`);var t,n,s,o;const a=e?e.toString():"",u=(s=this.publicID,o=this.version,l=!1!==(l=this.urlConfig.forceVersion),o?`v${o}`:!(s.match(/^v[0-9]+/)||s.match(/^https?:\//)||s.indexOf("/")<0)&&l?"v1":""),c=this.publicID;if("string"==typeof e)return[i,this.getResourceType(),this.getSignature(),a,u,c.replace(/,/g,"%2C"),this.suffix].filter(t=>t).join("/");{var l=[encodeURI(i),this.getResourceType(),this.getSignature(),encodeURI(a),u,encodeURI(c).replace(/,/g,"%2C"),this.suffix&&encodeURI(this.suffix)].filter(t=>t).join("/").replace(/\?/g,"%3F").replace(/=/g,"%3D"),e=!1!==this.urlConfig.analytics&&!c.includes("?");let t="";if("object"==typeof this.urlConfig.queryParams)try{const h=new URLSearchParams(this.urlConfig.queryParams);e&&h.set("_a",k(r)),t=h.toString()}catch(t){console.error("Error: URLSearchParams is not available so the queryParams object cannot be parsed, please try passing as an already parsed string")}else t=this.urlConfig.queryParams||"",e&&(t+=`${0<t.length?"&":""}_a=${k(r)}`);return t?`${l}?${t}`:l}}}{constructor(t,e,r,i){super(t,e,r),this.transformation=i}animated(t){return this.transformation.animated(t),this}border(t){return this.transformation.border(t),this}reshape(t){return this.transformation.reshape(t),this}resize(t){return this.transformation.resize(t),this}quality(t){return this.addAction(new v("q",t)),this}format(t){return this.addAction(new v("f",t)),this}roundCorners(t){return this.transformation.roundCorners(t),this}overlay(t){return this.transformation.overlay(t),this}addVariable(t){return this.transformation.addVariable(t),this}conditional(t){return this.transformation.conditional(t),this}effect(t){return this.transformation.effect(t),this}adjust(t){return this.transformation.adjust(t),this}rotate(t){return this.transformation.rotate(t),this}namedTransformation(t){return this.transformation.namedTransformation(t),this}delivery(t){return this.transformation.delivery(t),this}backgroundColor(t){return this.transformation.backgroundColor(t),this}psdTools(t){return this.transformation.psdTools(t),this}extract(t){return this.transformation.extract(t),this}addFlag(t){return this.transformation.addFlag(t),this}customFunction(t){return this.transformation.customFunction(t),this}addAction(t){return this.transformation.addAction(t),this}addTransformation(t){return this.transformation.addTransformation(t),this}toString(){return this.transformation.toString()}underlay(t){return this.transformation.underlay(t),this}toURL(t={}){return this.createCloudinaryURL(this.transformation,null==t?void 0:t.trackedAnalytics)}}class z extends V{constructor(t,e,r){super(t,e,r,new b)}}class R extends _{}class I extends V{constructor(t,e,r){super(t,e,r,new R),this.assetType="video"}transcode(t){return this.transformation.transcode(t),this}videoEdit(t){return this.transformation.videoEdit(t),this}}class E{constructor(t){t&&(this.cloudinaryConfig=t)}image(t){return new z(t,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}video(t){return new I(t,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}setConfig(t){return this.cloudinaryConfig=t,this}getConfig(){return this.cloudinaryConfig}extendConfig(){}}function F(t){return"object"==typeof t&&null!==t}function L(t){let e="";return e="undefined"!=typeof window?btoa(encodeURI(decodeURI(t))):global.Buffer.from(t).toString("base64"),e.replace(/\+/g,"-").replace(/\//g,"_")}const M={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"};const U={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialHeight:"ih",initialWidth:"iw",initial_duration:"idu",initialDuration:"idu",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w"};var q="(([0-9]*)\\.([0-9]+)|([0-9]+))([%pP])?";const D=RegExp(`^${q}$`),H=RegExp(`(${q})\\.\\.(${q})`),N={font_weight:"normal",font_style:"normal",text_decoration:"none",text_align:"",stroke:"none"};function B(t,e=/([^a-zA-Z0-9_.\-\/:]+)/g){return t.replace(e,function(t){return t.split("").map(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}).join("")})}const W=t=>t.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`);var Z=class Sr{constructor(r){this.options={},null!=r&&["resourceType","type","publicId","format"].forEach(t=>{var e;return this.options[t]=null!=(e=r[t])?e:r[W(t)]})}resourceType(t){return this.options.resourceType=t,this}type(t){return this.options.type=t,this}publicId(t){return this.options.publicId=t,this}getPublicId(){var t;return null!=(t=this.options.publicId)?t.replace(/\//g,":"):void 0}getFullPublicId(){return null!=this.options.format?this.getPublicId()+"."+this.options.format:this.getPublicId()}format(t){return this.options.format=t,this}toString(){let t=[];if(null==this.options.publicId)throw"Must supply publicId";return"image"!==this.options.resourceType&&t.push(this.options.resourceType),"upload"!==this.options.type&&t.push(this.options.type),t.push(this.getFullPublicId()),t.filter(t=>!!t).join(":")}clone(){return new Sr(this.options)}};function Q(t){return null==t||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&0===t.trim().length}function J(t){return null!=t&&!isNaN(parseFloat(t))}class Y extends Z{constructor(r){let t;super(r),t=["resourceType","resourceType","fontFamily","fontSize","fontWeight","fontStyle","textDecoration","textAlign","stroke","letterSpacing","lineSpacing","fontHinting","fontAntialiasing","text"],null!=r&&t.forEach(t=>{var e;return this.options[t]=null!=(e=r[t])?e:r[W(t)]}),this.options.resourceType="text"}resourceType(t){throw"Cannot modify resourceType for text layers"}type(t){throw"Cannot modify type for text layers"}format(t){throw"Cannot modify format for text layers"}fontFamily(t){return this.options.fontFamily=t,this}fontSize(t){return this.options.fontSize=t,this}fontWeight(t){return this.options.fontWeight=t,this}fontStyle(t){return this.options.fontStyle=t,this}textDecoration(t){return this.options.textDecoration=t,this}textAlign(t){return this.options.textAlign=t,this}stroke(t){return this.options.stroke=t,this}letterSpacing(t){return this.options.letterSpacing=t,this}lineSpacing(t){return this.options.lineSpacing=t,this}fontHinting(t){return this.options.fontHinting=t,this}fontAntialiasing(t){return this.options.fontAntialiasing=t,this}text(t){return this.options.text=t,this}toString(){var t,e,r,i,n,s,o,a,u=this.textStyleIdentifier();if(null!=this.options.publicId&&(r=this.getFullPublicId()),null!=this.options.text){if(t=!Q(r),e=!Q(u),t&&e||!t&&!e)throw"Must supply either style parameters or a public_id when providing text parameter in a text overlay/underlay, but not both!";for(i=/\$\([a-zA-Z]\w*\)/g,s=0,a=B(this.options.text,/[,\/]/g),o="";n=i.exec(a);)o+=B(a.slice(s,n.index)),o+=n[0],s=n.index+n[0].length;o+=B(a.slice(s))}return[this.options.resourceType,u,r,o].filter(t=>!!t).join(":")}textStyleIdentifier(){var t=[];if("normal"!==this.options.fontWeight&&t.push(this.options.fontWeight),"normal"!==this.options.fontStyle&&t.push(this.options.fontStyle),"none"!==this.options.textDecoration&&t.push(this.options.textDecoration),t.push(this.options.textAlign),"none"!==this.options.stroke&&t.push(this.options.stroke),Q(this.options.letterSpacing)&&!J(this.options.letterSpacing)||t.push("letter_spacing_"+this.options.letterSpacing),Q(this.options.lineSpacing)&&!J(this.options.lineSpacing)||t.push("line_spacing_"+this.options.lineSpacing),Q(this.options.fontAntialiasing)||t.push("antialias_"+this.options.fontAntialiasing),Q(this.options.fontHinting)||t.push("hinting_"+this.options.fontHinting),!Q(t.filter(t=>!!t))){if(Q(this.options.fontFamily))throw`Must supply fontFamily. ${t}`;if(Q(this.options.fontSize)&&!J(this.options.fontSize))throw"Must supply fontSize."}return t.unshift(this.options.fontFamily,this.options.fontSize),t=t.filter(t=>!!t).join("_")}}var K=Y;function G(r){const i=[];let t="";if(Object.keys(N).forEach(t=>{var e=N[t],t=r[t]||e;t!==e&&i.push(t)}),Object.keys(r).forEach(t=>{"letter_spacing"!==t&&"line_spacing"!==t||i.push(`${t}_${r[t]}`),"font_hinting"===t&&i.push(`${t.split("_").pop()}_${r[t]}`),"font_antialiasing"===t&&i.push(`antialias_${r[t]}`)}),r.hasOwnProperty("font_size")||!i||0===i.length){if(!r.font_size)throw"Must supply font_size for text in overlay/underlay";if(!r.font_family)throw"Must supply font_family for text in overlay/underlay";i.unshift(r.font_size),i.unshift(r.font_family),t=i.filter(t=>t).join("_")}return t}function X(o){if(o instanceof K||o instanceof Z)return o.toString();let a="";if(F(o))if("fetch"===o.resource_type||null!=o.url)a=`fetch:${L(o.url)}`;else{let t=o.public_id;var u=o.format;let e=o.resource_type||"image",r=o.type||"upload",n=o.text,s=null,i=[];var c=!t||0===t.length;if(c||(t=t.replace(new RegExp("/","g"),":"),null!=u&&(t=`${t}.${u}`)),n&&0!==n.length||"text"===e){if(e="text",r=null,s=G(o),n&&0<=n.length){u=!s;if(!c&&!u||c&&u)throw"Must supply either style parameters or a public_id when providing text parameter in a text overlay/underlay";let e=/\$\([a-zA-Z]\w*\)/g,r=0,i=B(decodeURIComponent(n),/[,\/]/g);n="";for(let t=e.exec(i);t;t=e.exec(i))n+=B(i.slice(r,t.index)),n+=t[0],r=t.index+t[0].length;n+=encodeURIComponent(i.slice(r))}}else{if(c)throw"Must supply public_id for resource_type layer_parameter";"subtitles"===e&&(s=G(o))}"image"!==e&&i.push(e),"upload"!==r&&i.push(r),i.push(s),i.push(t),i.push(n),a=i.filter(t=>t).join(":")}else a=/^fetch:.+/.test(o)?`fetch:${L(o.substr(6))}`:o;return a}function tt(t){if("string"!=typeof t||0===t.length||t.match(/^!.+!$/))return t&&t.toString();t=String(t);var e=new RegExp("((\\|\\||>=|<=|&&|!=|>|=|<|/|-|\\+|\\*|\\^)(?=[ _]))","g");t=t.replace(e,t=>M[t]);e="("+Object.keys(U).join("|")+")",e=new RegExp(`(\\$_*[^_ ]+)|${e}`,"g");return(t=t.replace(e,t=>U[t]||t)).replace(/[ _]+/g,"_")}function et(t){switch(!0){case null==t:return[];case Array.isArray(t):return t;default:return[t]}}function rt(t){if(!F(t))return t;if("remote"!==t.function_type)return[t.function_type,t.source].join(":");{const e=L(t.source).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return[t.function_type,e].join(":")}}function it(t){switch(t&&t.constructor){case String:return H.test(t)?t.split(".."):t;case Array:return[[t],t[t.length-1]];default:return[null,null]}}function nt(t){var e=String(t).match(D);if(e){var r=e[5]?"p":"";return`${e[1]||e[4]}${r}`}return t}class st{constructor(t){this.expressions=[],null!=t&&this.expressions.push(st.normalize(t))}static new(t){return new this(t)}static normalize(i){var t;return null==i?i:(i=String(i),t=new RegExp("((\\|\\||>=|<=|&&|!=|>|=|<|/|-|\\+|\\*|\\^)(?=[ _]))","g"),i=i.replace(t,t=>ot[t]),t="("+Object.keys(at).join("|")+")",t=new RegExp(t,"g"),(i=i.replace(t,(t,e,r)=>"$"===i[r-1]?t:at[t])).replace(/[ _]+/g,"_"))}serialize(){return st.normalize(this.expressions.join("_"))}toString(){return this.serialize()}getParent(){return this.parent}setParent(t){return this.parent=t,this}predicate(t,e,r){return null!=ot[e]&&(e=ot[e]),this.expressions.push(`${t}_${e}_${r}`),this}and(){return this.expressions.push("and"),this}or(){return this.expressions.push("or"),this}then(){return this.getParent().if(this.toString())}height(t,e){return this.predicate("h",t,e)}width(t,e){return this.predicate("w",t,e)}aspectRatio(t,e){return this.predicate("ar",t,e)}pageCount(t,e){return this.predicate("pc",t,e)}faceCount(t,e){return this.predicate("fc",t,e)}value(t){return this.expressions.push(t),this}static variable(t,e){return new this(t).value(e)}static width(){return new this("width")}static height(){return new this("height")}static initialWidth(){return new this("initialWidth")}static initialHeight(){return new this("initialHeight")}static aspectRatio(){return new this("aspectRatio")}static initialAspectRatio(){return new this("initialAspectRatio")}static pageCount(){return new this("pageCount")}static faceCount(){return new this("faceCount")}static currentPage(){return new this("currentPage")}static tags(){return new this("tags")}static pageX(){return new this("pageX")}static pageY(){return new this("pageY")}}const ot={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},at={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp","preview:duration":"preview:duration",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_duration:"idu",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialDuration:"idu",initialHeight:"ih",initialWidth:"iw",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w"};var ut=st;class ct extends ut{constructor(t){super(t)}height(t,e){return this.predicate("h",t,e)}width(t,e){return this.predicate("w",t,e)}aspectRatio(t,e){return this.predicate("ar",t,e)}pageCount(t,e){return this.predicate("pc",t,e)}faceCount(t,e){return this.predicate("fc",t,e)}duration(t,e){return this.predicate("du",t,e)}initialDuration(t,e){return this.predicate("idu",t,e)}}var lt=ct;"undefined"!=typeof window&&null!==window&&window.location&&window.location.protocol;var ht="__lodash_hash_undefined__",pt=9007199254740991,ft="[object Arguments]",dt="[object Boolean]",gt="[object Date]",mt="[object Function]",yt="[object GeneratorFunction]",vt="[object Map]",_t="[object Number]",bt="[object Object]",wt="[object Promise]",xt="[object RegExp]",jt="[object Set]",At="[object String]",St="[object Symbol]",Ot="[object WeakMap]",$t="[object ArrayBuffer]",Ct="[object DataView]",Pt="[object Float32Array]",kt="[object Float64Array]",Tt="[object Int8Array]",Vt="[object Int16Array]",zt="[object Int32Array]",Rt="[object Uint8Array]",It="[object Uint8ClampedArray]",Et="[object Uint16Array]",Ft="[object Uint32Array]",Lt=/\w*$/,Mt=/^\[object .+?Constructor\]$/,Ut=/^(?:0|[1-9]\d*)$/,qt={};qt[ft]=qt["[object Array]"]=qt[$t]=qt[Ct]=qt[dt]=qt[gt]=qt[Pt]=qt[kt]=qt[Tt]=qt[Vt]=qt[zt]=qt[vt]=qt[_t]=qt[bt]=qt[xt]=qt[jt]=qt[At]=qt[St]=qt[Rt]=qt[It]=qt[Et]=qt[Ft]=!0,qt["[object Error]"]=qt[mt]=qt[Ot]=!1;var Dt="object"==typeof global&&global&&global.Object===Object&&global,Ht="object"==typeof self&&self&&self.Object===Object&&self,Nt=Dt||Ht||Function("return this")(),Bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Wt=Bt&&"object"==typeof module&&module&&!module.nodeType&&module,w=Wt&&Wt.exports===Bt;function Zt(t,e){return t.set(e[0],e[1]),t}function Qt(t,e){return t.add(e),t}function Jt(t,e,r,i){var n=-1,s=t?t.length:0;for(i&&s&&(r=t[++n]);++n<s;)r=e(r,t[n],n,t);return r}function Yt(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!`${t}`}catch(t){}return e}function Kt(t){var r=-1,i=Array(t.size);return t.forEach(function(t,e){i[++r]=[e,t]}),i}function Gt(e,r){return function(t){return e(r(t))}}function Xt(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var q=Array.prototype,Dt=Function.prototype,te=Object.prototype,Ht=Nt["__core-js_shared__"],ee=(Wt=/[^.]+$/.exec(Ht&&Ht.keys&&Ht.keys.IE_PROTO||""))?`Symbol(src)_1.${Wt}`:"",re=Dt.toString,ie=te.hasOwnProperty,ne=te.toString,se=RegExp(`^${re.call(ie).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")}$`),Bt=w?Nt.Buffer:void 0,Ht=Nt.Symbol,oe=Nt.Uint8Array,ae=Gt(Object.getPrototypeOf,Object),ue=Object.create,ce=te.propertyIsEnumerable,le=q.splice,Wt=Object.getOwnPropertySymbols,Dt=Bt?Bt.isBuffer:void 0,he=Gt(Object.keys,Object),w=Ve(Nt,"DataView"),pe=Ve(Nt,"Map"),q=Ve(Nt,"Promise"),Bt=Ve(Nt,"Set"),Nt=Ve(Nt,"WeakMap"),fe=Ve(Object,"create"),de=Ee(w),ge=Ee(pe),me=Ee(q),ye=Ee(Bt),ve=Ee(Nt),Ht=Ht?Ht.prototype:void 0,_e=Ht?Ht.valueOf:void 0;function be(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function we(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function xe(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function je(t){this.__data__=new we(t)}function Ae(t,e){var r,i,n,s,o=Me(t)||function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Ue(t)}(r=t)&&ie.call(r,"callee")&&(!ce.call(r,"callee")||ne.call(r)==ft)?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],a=o.length,u=!!a;for(i in t)!e&&!ie.call(t,i)||u&&("length"==i||(n=i,!!(s=null==(s=a)?pt:s)&&("number"==typeof n||Ut.test(n))&&-1<n&&n%1==0&&n<s))||o.push(i);return o}function Se(t,e,r){var i=t[e];ie.call(t,e)&&Le(i,r)&&(void 0!==r||e in t)||(t[e]=r)}function Oe(t,e){for(var r=t.length;r--;)if(Le(t[r][0],e))return r;return-1}function $e(r,i,n,s,t,e,o){var a;if(void 0!==(a=s?e?s(r,t,e,o):s(r):a))return a;if(!He(r))return r;var u,c=Me(r);if(c){if(a=function(t){var e=t.length,r=t.constructor(e);e&&"string"==typeof t[0]&&ie.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(r),!i)return function(t,e){var r=-1,i=t.length;e=e||Array(i);for(;++r<i;)e[r]=t[r];return e}(r,a)}else{var l=Re(r),h=l==mt||l==yt;if(qe(r))return function(t,e){if(e)return t.slice();e=new t.constructor(t.length);return t.copy(e),e}(r,i);if(l==bt||l==ft||h&&!e){if(Yt(r))return e?r:{};if(a="function"!=typeof(u=h?{}:r).constructor||Ie(u)?{}:function(t){return He(t)?ue(t):{}}(ae(u)),!i)return h=t=r,u=(u=a)&&ke(h,Ne(h),u),ke(t,ze(t),u)}else{if(!qt[l])return e?r:{};a=function(t,e,r,i){var n=t.constructor;switch(e){case $t:return Pe(t);case dt:case gt:return new n(+t);case Ct:return function(t,e){e=e?Pe(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}(t,i);case Pt:case kt:case Tt:case Vt:case zt:case Rt:case It:case Et:case Ft:return function(t,e){e=e?Pe(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}(t,i);case vt:return function(t,e,r){return Jt(e?r(Kt(t),!0):Kt(t),Zt,new t.constructor)}(t,i,r);case _t:case At:return new n(t);case xt:return function(t){var e=new t.constructor(t.source,Lt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case jt:return function(t,e,r){return Jt(e?r(Xt(t),!0):Xt(t),Qt,new t.constructor)}(t,i,r);case St:return function(t){return _e?Object(_e.call(t)):{}}(t)}}(r,l,$e,i)}}var p,l=(o=o||new je).get(r);return l||(o.set(r,a),function(t,e){for(var r=-1,i=t?t.length:0;++r<i&&!1!==e(t[r],r,t););}((p=!c?n?function(t,e,r){e=e(t);return Me(t)?e:function(t,e){for(var r=-1,i=e.length,n=t.length;++r<i;)t[n+r]=e[r];return t}(e,r(t))}(r,Ne,ze):Ne(r):p)||r,function(t,e){p&&(t=r[e=t]),Se(a,e,$e(t,i,n,s,e,r,o))}),a)}function Ce(t){var e;return He(t)&&(e=t,!(ee&&ee in e))&&(De(t)||Yt(t)?se:Mt).test(Ee(t))}function Pe(t){var e=new t.constructor(t.byteLength);return new oe(e).set(new oe(t)),e}function ke(t,e,r,i){r=r||{};for(var n=-1,s=e.length;++n<s;){var o=e[n],a=i?i(r[o],t[o],o,r,t):void 0;Se(r,o,void 0===a?t[o]:a)}return r}function Te(t,e){var r,i=t.__data__;return("string"==(t=typeof(r=e))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function Ve(t,e){e=e,e=null==(t=t)?void 0:t[e];return Ce(e)?e:void 0}be.prototype.clear=function(){this.__data__=fe?fe(null):{}},be.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},be.prototype.get=function(t){var e=this.__data__;if(fe){var r=e[t];return r===ht?void 0:r}return ie.call(e,t)?e[t]:void 0},be.prototype.has=function(t){var e=this.__data__;return fe?void 0!==e[t]:ie.call(e,t)},be.prototype.set=function(t,e){return this.__data__[t]=fe&&void 0===e?ht:e,this},we.prototype.clear=function(){this.__data__=[]},we.prototype.delete=function(t){var e=this.__data__;return!((t=Oe(e,t))<0)&&(t==e.length-1?e.pop():le.call(e,t,1),!0)},we.prototype.get=function(t){var e=this.__data__;return(t=Oe(e,t))<0?void 0:e[t][1]},we.prototype.has=function(t){return-1<Oe(this.__data__,t)},we.prototype.set=function(t,e){var r=this.__data__,i=Oe(r,t);return i<0?r.push([t,e]):r[i][1]=e,this},xe.prototype.clear=function(){this.__data__={hash:new be,map:new(pe||we),string:new be}},xe.prototype.delete=function(t){return Te(this,t).delete(t)},xe.prototype.get=function(t){return Te(this,t).get(t)},xe.prototype.has=function(t){return Te(this,t).has(t)},xe.prototype.set=function(t,e){return Te(this,t).set(t,e),this},je.prototype.clear=function(){this.__data__=new we},je.prototype.delete=function(t){return this.__data__.delete(t)},je.prototype.get=function(t){return this.__data__.get(t)},je.prototype.has=function(t){return this.__data__.has(t)},je.prototype.set=function(t,e){var r=this.__data__;if(r instanceof we){var i=r.__data__;if(!pe||i.length<199)return i.push([t,e]),this;r=this.__data__=new xe(i)}return r.set(t,e),this};var ze=Wt?Gt(Wt,Object):function(){return[]},Re=function(t){return ne.call(t)};function Ie(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||te)}function Ee(t){if(null!=t){try{return re.call(t)}catch(t){}try{return`${t}`}catch(t){}}return""}function Fe(t){return $e(t,!0,!0)}function Le(t,e){return t===e||t!=t&&e!=e}(w&&Re(new w(new ArrayBuffer(1)))!=Ct||pe&&Re(new pe)!=vt||q&&Re(q.resolve())!=wt||Bt&&Re(new Bt)!=jt||Nt&&Re(new Nt)!=Ot)&&(Re=function(t){var e=ne.call(t),t=e==bt?t.constructor:void 0,t=t?Ee(t):void 0;if(t)switch(t){case de:return Ct;case ge:return vt;case me:return wt;case ye:return jt;case ve:return Ot}return e});var Me=Array.isArray;function Ue(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=pt)&&!De(t);var e}var qe=Dt||function(){return!1};function De(t){t=He(t)?ne.call(t):"";return t==mt||t==yt}function He(t){var e=typeof t;return t&&("object"==e||"function"==e)}function Ne(t){return(Ue(t)?Ae:function(t){if(!Ie(t))return he(t);var e,r=[];for(e in Object(t))ie.call(t,e)&&"constructor"!=e&&r.push(e);return r})(t)}function Be(t){return function(e,r){var i,n,i={};for(let t in e){n=e[t];if(r)t=r(t);if(!Q(t))i[t]=n}return i}(t,We)}function We(t){let e=t.match(Ze);return e=e.map(t=>t.charAt(0).toLocaleUpperCase()+t.slice(1).toLocaleLowerCase()),e[0]=e[0].toLocaleLowerCase(),e.join("")}var Ze=RegExp("[A-Z]+(?=[A-Z][a-z]+)|[A-Z]?[a-z]+|[A-Z]+|[0-9]+","g");function Qe(t){return t}function Je(e,r){for(let t=0;t<e.length;t++)if(e[t]===r)return 1}class Ye extends K{constructor(t){super(t),this.options.resourceType="subtitles"}}var Ke=Ye;function Ge(t){return"string"==typeof t||t instanceof String}class Xe extends Z{constructor(t){super(t),Ge(t)?this.options.url=t:null!=t&&t.url&&(this.options.url=t.url)}url(t){return this.options.url=t,this}toString(){return`fetch:${L(this.options.url)}`}}var tr=Xe;function er(t){return t instanceof Function}const rr=["accessibility","api_secret","auth_token","cdn_subdomain","cloud_name","cname","format","placeholder","private_cdn","resource_type","secure","secure_cdn_subdomain","secure_distribution","shorten","sign_url","signature","ssl_detected","type","url_suffix","use_root_path","version"];function ir(r,...t){return t.forEach(e=>{Object.keys(e).forEach(t=>{null!=e[t]&&(r[t]=e[t])})}),r}class nr{constructor(t,e,r=Qe){this.name=t,this.shortName=e,this.process=r}set(t){return this.origValue=t,this}serialize(){var t=this.value(),e=Array.isArray(t)||F(t)||Ge(t)?!Q(t):null!=t;return null!=this.shortName&&e?`${this.shortName}_${t}`:""}value(){return this.process(this.origValue)}static norm_color(t){return null!=t?t.replace(/^#/,"rgb:"):void 0}static build_array(t){return null==t?[]:Array.isArray(t)?t:[t]}static process_video_params(t){var e;switch(t.constructor){case Object:return e="","codec"in t&&(e=t.codec,"profile"in t&&(e+=":"+t.profile,"level"in t&&(e+=":"+t.level))),e;case String:return t;default:return null}}}class sr extends nr{constructor(t,e,r=".",i=void 0){super(t,e,i),this.sep=r}serialize(){if(null==this.shortName)return"";{let t=this.value();if(Q(t))return"";if(Ge(t))return`${this.shortName}_${t}`;var e=t.map(t=>er(t.serialize)?t.serialize():t).join(this.sep);return`${this.shortName}_${e}`}}value(){return Array.isArray(this.origValue)?this.origValue.map(t=>this.process(t)):this.process(this.origValue)}set(t){return null==t||Array.isArray(t)?super.set(t):super.set([t])}}class or extends nr{constructor(t,e="t",r=".",i=void 0){super(t,e,i),this.sep=r}serialize(){let t="";const e=this.value();return Q(e)||((r=e).length&&r.every(Ge)?Q(r=e.join(this.sep))||(t=`${this.shortName}_${r}`):t=e.map(t=>Ge(t)&&!Q(t)?`${this.shortName}_${t}`:er(t.serialize)?t.serialize():F(t)&&!Q(t)?new mr(t).serialize():void 0).filter(t=>t)),t;var r}set(t){return this.origValue=t,Array.isArray(this.origValue)?super.set(this.origValue):super.set([this.origValue])}}class ar extends nr{constructor(t,e,r=ar.norm_range_value){super(t,e,r)}static norm_range_value(t){var e,r=String(t).match(new RegExp("^(([0-9]*)\\.([0-9]+)|([0-9]+))([%pP])?$"));return r&&(e=null!=r[5]?"p":"",t=(r[1]||r[4])+e),t}}class ur extends nr{constructor(t,e,r=Qe){super(t,e,r)}serialize(){return this.value()}}class cr extends nr{value(){if(null==this.origValue)return"";let t;var e;return t=this.origValue instanceof Z?this.origValue:F(this.origValue)?new("text"===(e=Be(this.origValue)).resourceType||null!=e.text?K:"subtitles"===e.resourceType?Ke:"fetch"===e.resourceType||null!=e.url?tr:Z)(e):Ge(this.origValue)?/^fetch:.+/.test(this.origValue)?new tr(this.origValue.substr(6)):this.origValue:"",t.toString()}static textStyle(t){return new K(t).textStyleIdentifier()}}class lr{constructor(t){let e,o;e=void 0,o={},this.toOptions=t=>{let e={};if(null==t&&(t=!0),Object.keys(o).forEach(t=>e[t]=o[t].origValue),ir(e,this.otherOptions),t&&!Q(this.chained)){let t=this.chained.map(t=>t.toOptions());t.push(e),e={},ir(e,this.otherOptions),e.transformation=t}return e},this.setParent=t=>(null!=(e=t)&&this.fromOptions("function"==typeof t.toOptions?t.toOptions():void 0),this),this.getParent=()=>e,this.param=(t,e,r,i,n)=>(null==n&&(n=er(i)?i:Qe),o[e]=new nr(e,r,n).set(t),this),this.rawParam=function(t,e,r,i,n){return n=dr(arguments),o[e]=new ur(e,r,n).set(t),this},this.rangeParam=function(t,e,r,i,n){return n=dr(arguments),o[e]=new ar(e,r,n).set(t),this},this.arrayParam=function(t,e,r,i=":",n,s=void 0){return s=dr(arguments),o[e]=new sr(e,r,i,s).set(t),this},this.transformationParam=function(t,e,r,i=".",n,s=void 0){return s=dr(arguments),o[e]=new or(e,r,i,s).set(t),this},this.layerParam=function(t,e,r){return o[e]=new cr(e,r).set(t),this},this.getValue=function(t){var e=o[t]&&o[t].value();return null!=e?e:this.otherOptions[t]},this.get=function(t){return o[t]},this.remove=function(t){var e;switch(!1){case null==o[t]:return e=o[t],delete o[t],e.origValue;case null==this.otherOptions[t]:return e=this.otherOptions[t],delete this.otherOptions[t],e;default:return null}},this.keys=function(){var e;return function(){var t=[];for(e in o)null!=e&&t.push(e.match(hr)?e:W(e));return t}().sort()},this.toPlainObject=function(){var t,e,r={};for(t in o)r[t]=o[t].value(),F(r[t])&&(r[t]=Fe(r[t]));return Q(this.chained)||((e=this.chained.map(t=>t.toPlainObject())).push(r),r={transformation:e}),r},this.chain=function(){var t;return 0!==Object.getOwnPropertyNames(o).length&&(t=new this.constructor(this.toOptions(!1)),this.resetTransformations(),this.chained.push(t)),this},this.resetTransformations=function(){return o={},this},this.otherOptions={},this.chained=[],this.fromOptions(t)}fromOptions(t={}){if(t instanceof lr)this.fromTransformation(t);else for(var e in(t=Fe(t=Ge(t)||Array.isArray(t)?{transformation:t}:t)).if&&(this.set("if",t.if),delete t.if),t){var r=t[e];null!=r&&(e.match(hr)?"$attr"!==e&&this.set("variable",e,r):this.set(e,r))}return this}fromTransformation(e){return e instanceof lr&&e.keys().forEach(t=>this.set(t,e.get(t).origValue)),this}set(t,...e){var r=We(t);return Je(yr,r)?this[r].apply(this,e):this.otherOptions[t]=e[0],this}hasLayer(){return this.getValue("overlay")||this.getValue("underlay")}serialize(){var t,e,r,i,n,s,o,a,u=this.chained.map(t=>t.serialize()),c=this.keys(),l=null!=(h=this.get("transformation"))?h.serialize():void 0,h=null!=(p=this.get("if"))?p.serialize():void 0,p=function(t){var e,r,i,n,s;{if(Array.isArray(t)){for(n=[],e=0,r=t.length;e<r;e++)[i,s]=t[e],n.push(`${i}_${ut.normalize(s)}`);return n}return t}}(null!=(p=this.get("variables"))?p.value():void 0);for(a=["transformation","if","variables"],c=c.filter(t=>!a.includes(t)),o=[],n=[],t=0,e=c.length;t<e;t++)(i=c[t]).match(hr)?o.push(i+"_"+ut.normalize(null!=(r=this.get(i))?r.value():void 0)):n.push(null!=(i=this.get(i))?i.serialize():void 0);switch(!1){case!Ge(l):n.push(l);break;case!Array.isArray(l):u=u.concat(l)}return n=function(){for(var t=[],e=0,r=n.length;e<r;e++)s=n[e],(Array.isArray(s)&&!Q(s)||!Array.isArray(s)&&s)&&t.push(s);return t}(),n=o.sort().concat(p).concat(n.sort()),"if_end"===h?n.push(h):Q(h)||n.unshift(h),Q(h=n.filter(t=>!!t).join(fr))||u.push(h),u.filter(t=>!!t).join(pr)}static listNames(){return yr}toHtmlAttributes(){let e,t,r,i,n,s,o;r={};let a;return Object.keys(this.otherOptions).forEach(t=>{s=this.otherOptions[t],a=W(t),Je(vr,a)||Je(rr,a)||(e=/^html_/.test(t)?t.slice(5):t,r[e]=s)}),this.keys().forEach(t=>{/^html_/.test(t)&&(r[We(t.slice(5))]=this.getValue(t))}),this.hasLayer()||this.getValue("angle")||Je(["fit","limit","lfill"],this.getValue("crop"))||(o=null!=(i=this.get("width"))?i.origValue:void 0,t=null!=(n=this.get("height"))?n.origValue:void 0,1<=parseFloat(o)&&null==r.width&&(r.width=o),1<=parseFloat(t)&&null==r.height&&(r.height=t)),r}static isValidParamName(t){return 0<=yr.indexOf(We(t))}toHtml(){var t;return null!=(t=this.getParent())&&"function"==typeof t.toHtml?t.toHtml():void 0}toString(){return this.serialize()}clone(){return new lr(this.toOptions(!0))}}const hr=/^\$[a-zA-Z0-9]+$/,pr="/",fr=",";function dr(t){t=null!=t?t[t.length-1]:void 0;if(er(t))return t}function gr({function_type:t,source:e}){return"remote"===t?[t,btoa(e)].join(":"):"wasm"===t?[t,e].join(":"):void 0}class mr extends lr{constructor(t){super(t)}static new(t){return new mr(t)}angle(t){return this.arrayParam(t,"angle","a",".",ut.normalize),this}audioCodec(t){return this.param(t,"audio_codec","ac"),this}audioFrequency(t){return this.param(t,"audio_frequency","af"),this}aspectRatio(t){return this.param(t,"aspect_ratio","ar",ut.normalize),this}background(t){return this.param(t,"background","b",nr.norm_color),this}bitRate(t){return this.param(t,"bit_rate","br"),this}border(t){return this.param(t,"border","bo",t=>F(t)?`${(t=Object.assign({},{color:"black",width:2},t)).width}px_solid_${nr.norm_color(t.color)}`:t)}color(t){return this.param(t,"color","co",nr.norm_color),this}colorSpace(t){return this.param(t,"color_space","cs"),this}crop(t){return this.param(t,"crop","c"),this}customFunction(t){return this.param(t,"custom_function","fn",()=>gr(t))}customPreFunction(t){if(!this.get("custom_function"))return this.rawParam(t,"custom_function","",()=>(t=gr(t))&&`fn_pre:${t}`)}defaultImage(t){return this.param(t,"default_image","d"),this}delay(t){return this.param(t,"delay","dl"),this}density(t){return this.param(t,"density","dn"),this}duration(t){return this.rangeParam(t,"duration","du"),this}dpr(t){return this.param(t,"dpr","dpr",t=>null!=(t=t.toString())&&t.match(/^\d+$/)?t+".0":ut.normalize(t))}effect(t){return this.arrayParam(t,"effect","e",":",ut.normalize),this}else(){return this.if("else")}endIf(){return this.if("end")}endOffset(t){return this.rangeParam(t,"end_offset","eo"),this}fallbackContent(t){return this.param(t,"fallback_content"),this}fetchFormat(t){return this.param(t,"fetch_format","f"),this}format(t){return this.param(t,"format"),this}flags(t){return this.arrayParam(t,"flags","fl","."),this}gravity(t){return this.param(t,"gravity","g"),this}fps(t){return this.param(t,"fps","fps",t=>!Ge(t)&&Array.isArray(t)?t.join("-"):t)}height(t){return this.param(t,"height","h",()=>this.getValue("crop")||this.getValue("overlay")||this.getValue("underlay")?ut.normalize(t):null)}htmlHeight(t){return this.param(t,"html_height"),this}htmlWidth(t){return this.param(t,"html_width"),this}if(t=""){var e,r,i,n,s;switch(t){case"else":return this.chain(),this.param(t,"if","if");case"end":for(this.chain(),e=i=this.chained.length-1;0<=i&&"end"!==(r=this.chained[e].getValue("if"))&&(null==r||(n=mr.new().if(r),this.chained[e].remove("if"),s=this.chained[e],this.chained[e]=mr.new().transformation([n,s]),"else"===r));e=i+=-1);return this.param(t,"if","if");case"":return lt.new().setParent(this);default:return this.param(t,"if","if",t=>lt.new(t).toString())}}keyframeInterval(t){return this.param(t,"keyframe_interval","ki"),this}ocr(t){return this.param(t,"ocr","ocr"),this}offset(t){var e;if([e,t]=er(null!=t?t.split:void 0)?t.split(".."):Array.isArray(t)?t:[null,null],null!=e&&this.startOffset(e),null!=t)return this.endOffset(t)}opacity(t){return this.param(t,"opacity","o",ut.normalize),this}overlay(t){return this.layerParam(t,"overlay","l"),this}page(t){return this.param(t,"page","pg"),this}poster(t){return this.param(t,"poster"),this}prefix(t){return this.param(t,"prefix","p"),this}quality(t){return this.param(t,"quality","q",ut.normalize),this}radius(t){return this.arrayParam(t,"radius","r",":",ut.normalize),this}rawTransformation(t){return this.rawParam(t,"raw_transformation"),this}size(t){var e;if(er(null!=t?t.split:void 0))return[e,t]=t.split("x"),this.width(e),this.height(t)}sourceTypes(t){return this.param(t,"source_types"),this}sourceTransformation(t){return this.param(t,"source_transformation")}startOffset(t){return this.rangeParam(t,"start_offset","so"),this}streamingProfile(t){return this.param(t,"streaming_profile","sp"),this}transformation(t){return this.transformationParam(t,"transformation","t"),this}underlay(t){return this.layerParam(t,"underlay","u"),this}variable(t,e){return this.param(e,t,t),this}variables(t){return this.arrayParam(t,"variables"),this}videoCodec(t){return this.param(t,"video_codec","vc",nr.process_video_params),this}videoSampling(t){return this.param(t,"video_sampling","vs"),this}width(t){return this.param(t,"width","w",()=>this.getValue("crop")||this.getValue("overlay")||this.getValue("underlay")?ut.normalize(t):null),this}x(t){return this.param(t,"x","x",ut.normalize),this}y(t){return this.param(t,"y","y",ut.normalize),this}zoom(t){return this.param(t,"zoom","z",ut.normalize),this}}const yr=["angle","audioCodec","audioFrequency","aspectRatio","background","bitRate","border","color","colorSpace","crop","customFunction","customPreFunction","defaultImage","delay","density","duration","dpr","effect","else","endIf","endOffset","fallbackContent","fetchFormat","format","flags","gravity","fps","height","htmlHeight","htmlWidth","if","keyframeInterval","ocr","offset","opacity","overlay","page","poster","prefix","quality","radius","rawTransformation","size","sourceTypes","sourceTransformation","startOffset","streamingProfile","transformation","underlay","variable","variables","videoCodec","videoSampling","width","x","y","zoom"],vr=yr.map(W).concat(["api_key","api_secret","callback","cdn_subdomain","cloud_name","cname","private_cdn","protocol","resource_type","responsive","responsive_class","responsive_use_breakpoints","responsive_width","round_dpr","secure","secure_cdn_subdomain","secure_distribution","shorten","type","upload_preset","url_suffix","use_root_path","version","externalLibraries","max_timeout_ms"]);var _r,br=mr;const wr=function e(t){if("string"==typeof t)return t;if(t instanceof br)return t.toString();if(Array.isArray(t))return t.map(t=>e(t)).filter(t=>t).join("/");let r,i;const n=t.size;var s=t.overlay||t.underlay,o=t.crop,a=et(t.angle).join("."),u=(t.background||"").replace(/^#/,"rgb:"),c=(t.color||"").replace(/^#/,"rgb:"),l=et(t.flags||[]).join("."),h=void 0===t.dpr?t.dpr:function(t){let e=t.toString();return null!=e&&e.match(/^\d+$/)?e+".0":ut.normalize(e)}(t.dpr),p=X(t.overlay),f=function(t){let e=t;if(!e)return e;if(Array.isArray(e)||(e=[e]),0===e.length||4<e.length)throw new Error("Radius array should contain between 1 and 4 values");if(0<=e.findIndex(t=>null===t))throw new Error("Corner: Cannot be null");return e.map(tt).join(":")}(t.radius),d=X(t.underlay);const g=(j=t.if)&&"if_"+tt(j);var m=rt(t.custom_function),y="string"==typeof(x=rt(x=t.custom_pre_function))?`pre:${x}`:null;let v=t.fps,_=[],b=et(t.transformation||[]),w=t.effect;var x,j=s||a||"fit"===o||"limit"===o;i=n?([x,s]=n.split("x"),r=x,s):(r=t.width,t.height),r&&(0===r.toString().indexOf("auto")||j||parseFloat(r.toString())<1)&&delete t.width,i&&(j||parseFloat(i.toString())<1)&&delete t.height;j=b.some(t=>"object"==typeof t);b=j?b.map(t=>F(t)?e(t):e({transformation:t})).filter(t=>t):(_=b.join("."),[]),Array.isArray(w)?w=w.join(":"):F(w)&&(w=Object.entries(w).map(([t,e])=>`${t}:${e}`));let A=t.border;F(A)?A=`${null!=A.width?A.width:2}px_solid_${(null!=A.color?A.color:"black").replace(/^#/,"rgb:")}`:/^\d+$/.exec(A)&&(t.border=A,A=void 0),Array.isArray(v)&&(v=v.join("-"));d={a:tt(a),ar:tt(t.aspect_ratio),b:u,bo:A,c:o,co:c,dpr:tt(h),e:tt(w),fl:l,fn:m||y,fps:v,h:tt(i),ki:tt(t.keyframe_interval),l:p,o:tt(t.opacity),q:tt(t.quality),r:f,t:_,u:d,w:tt(r),x:tt(t.x),y:tt(t.y),z:tt(t.zoom),ac:t.audio_codec,af:t.audio_frequency,br:t.bit_rate,cs:t.color_space,d:t.default_image,dl:t.delay,dn:t.density,du:nt(t.duration),eo:nt(t.end_offset||J(t.end_offset)?t.end_offset:it(t.offset)[1]),f:t.fetch_format,g:t.gravity,pg:t.page,p:t.prefix,so:nt(t.start_offset||J(t.start_offset)?t.start_offset:it(t.offset)[0]),sp:t.streaming_profile,vc:function(e){switch(e&&e.constructor){case Object:{let t="";return"codec"in e&&(t=e.codec,"profile"in e&&(t+=":"+e.profile,"level"in e&&(t+=":"+e.level))),t}case String:return e;default:return null}}(t.video_codec),vs:t.video_sampling};const S=Object.entries(t).filter(([t])=>t.startsWith("$")).map(([t,e])=>`${t}_${tt(e)}`).sort().concat((t.variables||[]).map(([t,e])=>`${t}_${tt(e)}`)).join(","),O=Object.entries(d).filter(([,t])=>!(null==t||"string"==typeof t&&0===t.length||Array.isArray(t)&&0===t.length)).map(([t,e])=>`${t}_${e}`).sort().join(",");t=[g,S,O,t.raw_transformation].filter(t=>t).join(",");return t&&b.push(t),b.join("/")};function xr(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function jr(i){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xr(Object(n),!0).forEach(function(t){var e,r;e=i,t=n[r=t],r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):xr(Object(n)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))})}return i}_r={editor:null,init:function(t){var e=this;this.openCloudinaryBrowser=this.openCloudinaryBrowser.bind(this),this.insertImageHandler=this.insertImageHandler.bind(this),this.insertLinkHandler=this.insertLinkHandler.bind(this);var r=(this.editor=t).translate("Insert from Files"),i=t.translate("Edit image"),n=t.translate("File");t.ui.registry.addButton("ssmedia",{title:r,icon:"image",cmd:"ssmedia",onAction:function(){return t.execCommand("ssmedia")},stateSelector:'img[data-shortcode="image"]'}),t.ui.registry.addMenuItem("ssmedia",{text:n,icon:"image",cmd:"ssmedia"}),t.ui.registry.addButton("ssmediaedit",{title:i,icon:"editimage",cmd:"ssmedia"}),t.addCommand("ssmedia",function(){e.openCloudinaryBrowser(e.insertImageHandler)}),t.addCommand("sslinkfile",function(){e.openCloudinaryBrowser(e.insertLinkHandler)})},openCloudinaryBrowser:function(t){var e=jr(jr({},CLOUDINARY_CONFIG),{},{multiple:!1});-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&(delete e.username,delete e.timestamp,delete e.signature),cloudinary.openMediaLibrary(e,{insertHandler:t})},cloudinaryInstance:function(){return new E({cloud:{cloudName:CLOUDINARY_CONFIG.cloud_name}})},insertImageHandler:function(t){var e=t.assets[0];if(console.log("insertImageHandler",e),"image"!==e.resource_type)throw"Resource type of [".concat(e.resource_type,"] is not supported");var r=this.cloudinaryInstance().image(e.public_id),t=this.editor.getParam("default_transformations");t&&(i=wr(t),r.addTransformation(i));var t=e.context&&e.context.custom&&e.context.custom.alt?e.context.custom.alt:"",i=e.context&&e.context.custom&&e.context.custom.alt?e.context.custom.caption:"",e=prompt("Description",t),t=prompt("Title",i),i=document.createElement("img");i.src=r.toURL(),e&&(i.alt=e),t&&(i.title=t),console.log("img.outerHTML",i.outerHTML),this.editor.execCommand("mceInsertContent",!1,i.outerHTML)},insertLinkHandler:function(t){var e=t.assets[0],r=(e.derived&&0<e.derived.length?e.derived[0]:e).secure_url,t=this.editor.selection.getContent({format:"html"});t.trim().length<=0&&(t=prompt("Link text")),e.context&&e.context.custom&&e.context.custom.alt&&(i=e.context.custom.alt);var i=prompt("Description",i),i=i?'title="'.concat(i,'"'):"",t='<a href="'.concat(r,'" ').concat(i,">").concat(t,"</a>");this.editor.execCommand("mceInsertContent",!1,t)}},tinymce.PluginManager.add("ssmedia",function(t){_r.init(t)})}();
//# sourceMappingURL=tinymce.js.map